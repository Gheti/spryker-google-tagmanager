<!-- enhanced ecommerce start -->
<script type="text/javascript">
    {% if order is defined %}
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        event: 'eec.purchase',
        ecommerce: {
            currencyCode: '{{ order.currency.code }}',
            purchase: {
                actionField: {
                    id: '{{ order.orderReference }}',
                    affiliation: '{{ order.store.name }}',
                    revenue: '{{ order.totals.subtotal }}',
                    tax: '{{ order.totals.taxTotal.amount }}',
                    {% if shipment is defined  %}shipping: {{ shipment }},{% endif %}
                    {% if voucherCode is defined %}coupon: '{{ voucherCode }}'{% endif %}
                },
                {% if products is defined and products | length > 0 and order.items | length > 0 %}
                products: [
                    {% for item in order.items %}
                    {
                        id: '{{ item.sku }}',
                        name: '{{ item.name }}',
                        variant: '{{ products[item.sku].attributes.style }}',
                        brand: '{{ order.store.name }}',
                        quantity: {{ item.quantity }},
                        dimension1: '{{ products[item.sku].attributes.size }}',
                        price: '{{ item.unitPrice }}'
                    }{% if loop.last == false %},{% endif %}
                    {% endfor %}
                ]
                {% endif %}
            }
        }
    });
    {% endif %}
</script>
<!-- enhanced ecommerce end -->
