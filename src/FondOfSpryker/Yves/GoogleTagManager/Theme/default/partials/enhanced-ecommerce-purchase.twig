<!-- enhanced ecommerce start -->
<script type="text/javascript">
    {% if order is defined %}
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        event: 'eec.purchase',
        ecommerce: {
            currencyCode: '{{ order.currency.code }}',
            purchase: {
                actionField: {
                    id: '{{ order.orderReference }}',
                    affiliation: '{{ order.store.name }}',
                    revenue: '{{ order.totals.grandTotal }}',
                    tax: '{{ order.totals.taxTotal.amount }}',
                    {% if shipment is defined  %}shipping: {{ shipment }},{% endif %}
                    {% if voucherCode is defined %}coupon: '{{ voucherCode }}'{% endif %}
                },
                {% if products is defined and products | length > 0 and order.items | length > 0 %}
                    products: {{ products | json_encode | raw }}
                {% endif %}
            }
        }
    });
    {% endif %}
</script>
<!-- enhanced ecommerce end -->
